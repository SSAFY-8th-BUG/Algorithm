-- 코드를 입력하세요
SELECT * 
FROM (
    SELECT CAR_ID CAR_ID, CAR_TYPE CAR_TYPE, TRUNCATE(DAILY_FEE*30*(100-DISCOUNT_RATE)/100,0) AS FEE 
    FROM (
        SELECT RENTAL.CAR_ID , RENTAL.CAR_TYPE, RENTAL.DAILY_FEE, DISCOUNT.DISCOUNT_RATE  
        FROM (
            SELECT * 
            FROM CAR_RENTAL_COMPANY_CAR 
            WHERE CAR_ID NOT IN (
                SELECT CAR_ID 
                FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY AS HISTORY 
                WHERE START_DATE <='2022-11-30' AND END_DATE >= '2022-11-01'
            ) 
            AND CAR_TYPE IN ('세단','SUV')
        ) AS RENTAL -- 렌탈가능한 세단, SUV
        LEFT JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN AS DISCOUNT 
        ON RENTAL.CAR_TYPE = DISCOUNT.CAR_TYPE 
        WHERE DISCOUNT.DURATION_TYPE='30일 이상'
    )AS RENTAL30 -- 30일 할인율 JOIN
)AS RESULT -- FEE 계산
WHERE FEE>=500000 AND FEE<2000000
ORDER BY FEE DESC, CAR_TYPE ASC, CAR_ID DESC;

